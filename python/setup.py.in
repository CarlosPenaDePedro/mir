#!/usr/bin/env python

from distutils.core import setup, Extension
import os,sys

attdict = dict(
   sources = ['ecregrid_swig.c', 'utils.c'],
   swig_opts = [],
   include_dirs = ['.', '../src'],
   library_dirs = ["%s/lib" % sys.prefix, "../src"],
   libraries = ["ecregrid", "m"],
   extra_objects = [],
   depends = ["../src/libecregrid.a"],
)

add_attribute = lambda **args: [list.append(attdict[key],value) for key,value in args.items()]

build_dir = '../'

import glob
ofiles=glob.glob("%s*.o" % build_dir)

add_attribute(
    include_dirs = os.path.join(build_dir,'src'),
    extra_objects = os.path.join(build_dir,'src','ecregrid_api.o')
)

lib_dict = {
    'jasper': '@JASPER_ROOT@',
    'grib_api': '@GRIB_API_ROOT@',
}

for with_lib in lib_dict:
    if with_lib:
        lib_dir = lib_dict[with_lib]
        if lib_dir and lib_dir != 'system':
            add_attribute(
            include_dirs = os.path.join(lib_dir,'include'),
            library_dirs = os.path.join(lib_dir,'lib')
        )
    add_attribute(libraries = with_lib)

api_module = Extension('_ecregrid_swig',**attdict)

setup (name = 'ecregrid',
       version = '0.1',
       author      = 'ECMWF',
       description = """ecRegrid API Python interface""",
       ext_modules = [api_module],
       py_modules = ['ecregrid_swig', 'ecregrid'],
      )
